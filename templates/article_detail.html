{% extends "base.html" %}

{% block title %}{{ article_title }} - ä¸ªäººåšå®¢{% endblock %}

{% block extra_css %}
<style>
    /* æ–‡ç« è¯¦æƒ…é¡µç‰¹å®šæ ·å¼ */
    .article-header {
        margin-bottom: 2rem;
        padding-bottom: 1.5rem;
        border-bottom: 1px solid #eee;
    }
    
    .article-title {
        font-size: 2rem;
        font-weight: bold;
        margin-bottom: 0.5rem;
        color: #333;
    }
    
    .article-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        color: #6c757d;
        font-size: 0.9rem;
        margin-bottom: 1rem;
    }
    
    .article-meta-item {
        display: flex;
        align-items: center;
    }
    
    .article-meta-item i {
        margin-right: 0.3rem;
    }
    
    .article-tags {
        margin-top: 1rem;
    }
    
    /* æ–‡ç« å†…å®¹æ ·å¼ */
    .article-content {
        font-size: 1.1rem;
        line-height: 1.8;
        color: #444;
    }
    
    /* Markdownå†…å®¹æ ·å¼ */
    .article-content h1,
    .article-content h2,
    .article-content h3,
    .article-content h4,
    .article-content h5,
    .article-content h6 {
        margin-top: 1.5rem;
        margin-bottom: 1rem;
        font-weight: 600;
        line-height: 1.25;
        color: #333;
    }
    
    .article-content h1 { font-size: 1.8rem; }
    .article-content h2 { font-size: 1.6rem; }
    .article-content h3 { font-size: 1.4rem; }
    .article-content h4 { font-size: 1.2rem; }
    .article-content h5 { font-size: 1.1rem; }
    .article-content h6 { font-size: 1rem; color: #6c757d; }
    
    .article-content p {
        margin-bottom: 1.2rem;
    }
    
    .article-content a {
        color: #007bff;
        text-decoration: none;
    }
    
    .article-content a:hover {
        text-decoration: underline;
    }
    
    .article-content ul,
    .article-content ol {
        margin-bottom: 1.2rem;
        padding-left: 2rem;
    }
    
    .article-content li {
        margin-bottom: 0.5rem;
    }
    
    .article-content blockquote {
        margin: 1.5rem 0;
        padding: 1rem 1.5rem;
        border-left: 4px solid #007bff;
        background-color: #f8f9fa;
        color: #6c757d;
        font-style: italic;
    }
    
    .article-content blockquote p:last-child {
        margin-bottom: 0;
    }
    
    .article-content code {
        background-color: #f8f9fa;
        padding: 0.2rem 0.4rem;
        border-radius: 3px;
        font-size: 0.9em;
        font-family: 'Courier New', Courier, monospace;
    }
    
    .article-content pre {
        background-color: #f8f9fa;
        padding: 1rem;
        border-radius: 5px;
        overflow-x: auto;
        margin-bottom: 1.2rem;
    }
    
    .article-content pre code {
        background-color: transparent;
        padding: 0;
    }
    
    .article-content img {
        max-width: 100%;
        height: auto;
        border-radius: 5px;
        margin: 1.5rem 0;
    }
    
    .article-content table {
        width: 100%;
        margin-bottom: 1.2rem;
        border-collapse: collapse;
    }
    
    .article-content table th,
    .article-content table td {
        padding: 0.75rem;
        border: 1px solid #dee2e6;
    }
    
    .article-content table th {
        background-color: #f8f9fa;
        font-weight: bold;
    }
    
    .article-content hr {
        margin: 2rem 0;
        border: 0;
        border-top: 1px solid #eee;
    }
    
    /* æ–‡ç« å¯¼èˆª */
    .article-navigation {
        display: flex;
        justify-content: space-between;
        margin-top: 3rem;
        padding-top: 1.5rem;
        border-top: 1px solid #eee;
    }
    
    .article-navigation a {
        color: #007bff;
        text-decoration: none;
        font-weight: 500;
    }
    
    .article-navigation a:hover {
        text-decoration: underline;
    }
    
    /* å“åº”å¼è°ƒæ•´ */
    @media (max-width: 768px) {
        .article-title {
            font-size: 1.6rem;
        }
        
        .article-meta {
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .article-navigation {
            flex-direction: column;
            gap: 1rem;
        }
    }
</style>
{% endblock %}

{% block left_content %}
<div class="article-detail">
    <!-- æ–‡ç« å¤´éƒ¨ä¿¡æ¯ -->
    <div class="article-header">
        <h1 class="article-title">{{ article_title }}</h1>
        
        <div class="article-meta">
            <div class="article-meta-item">
                <i>ğŸ“…</i>
                <span>å‘å¸ƒäº {{ article_created_at|date:"Yå¹´mæœˆdæ—¥" }}</span>
            </div>
            
            {% if article_updated_at and article_updated_at != article_created_at %}
            <div class="article-meta-item">
                <i>âœï¸</i>
                <span>æ›´æ–°äº {{ article_updated_at|date:"Yå¹´mæœˆdæ—¥" }}</span>
            </div>
            {% endif %}
        </div>
        
        {% if article_tags %}
        <div class="article-tags">
            <i>ğŸ·ï¸</i>
            {% for tag in article_tags %}
            <a href="/tag/{{ tag.slug }}/" class="tag">{{ tag.name }}</a>
            {% endfor %}
        </div>
        {% endif %}
    </div>
    
    <!-- æ–‡ç« å†…å®¹ -->
    <div class="article-content">
        <!-- 
            æ³¨æ„ï¼šè¿™é‡Œç›´æ¥è¾“å‡ºå·²ç»è§£æçš„HTMLå†…å®¹
            åœ¨Djangoè§†å›¾ä¸­ï¼Œæ‚¨åº”è¯¥å·²ç»ä½¿ç”¨markdownåº“å°†Markdownè½¬æ¢ä¸ºHTML
            ä¾‹å¦‚ï¼šarticle.content_html = markdown.markdown(article.content)
        -->
        {% if article_content_html %}
            {{ article_content_html }}
        {% else %}
            <!-- å¦‚æœæœªæä¾›HTMLå†…å®¹ï¼Œåˆ™æ˜¾ç¤ºåŸå§‹å†…å®¹ï¼ˆå¯èƒ½åŒ…å«Markdownè¯­æ³•ï¼‰ -->
            <p>{{ article_content|linebreaks }}</p>
        {% endif %}
    </div>
    
    <!-- æ–‡ç« å¯¼èˆªï¼ˆä¸Šä¸€é¡µ/ä¸‹ä¸€é¡µï¼‰ -->
    {% if previous_article or next_article %}
    <div class="article-navigation">
        <div class="prev-article">
            {% if previous_article %}
            <a href="/article/{{ previous_article.slug }}/">
                <span>â† ä¸Šä¸€ç¯‡</span><br>
                <strong>{{ previous_article.title|truncatechars:30 }}</strong>
            </a>
            {% endif %}
        </div>
        
        <div class="next-article">
            {% if next_article %}
            <a href="/article/{{ next_article.slug }}/">
                <span>ä¸‹ä¸€ç¯‡ â†’</span><br>
                <strong>{{ next_article.title|truncatechars:30 }}</strong>
            </a>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
    // æ–‡ç« è¯¦æƒ…é¡µç‰¹å®šçš„JavaScriptä»£ç 
    document.addEventListener('DOMContentLoaded', function() {
        // 1. ä¸ºæ–‡ç« ä¸­çš„å›¾ç‰‡æ·»åŠ ç‚¹å‡»æŸ¥çœ‹å¤§å›¾åŠŸèƒ½
        const articleImages = document.querySelectorAll('.article-content img');
        articleImages.forEach(img => {
            img.style.cursor = 'pointer';
            img.addEventListener('click', function() {
                // åˆ›å»ºæ¨¡æ€æ¡†æŸ¥çœ‹å¤§å›¾
                const modal = document.createElement('div');
                modal.style.position = 'fixed';
                modal.style.top = '0';
                modal.style.left = '0';
                modal.style.width = '100%';
                modal.style.height = '100%';
                modal.style.backgroundColor = 'rgba(0,0,0,0.8)';
                modal.style.display = 'flex';
                modal.style.justifyContent = 'center';
                modal.style.alignItems = 'center';
                modal.style.zIndex = '2000';
                modal.style.cursor = 'zoom-out';
                
                const modalImg = document.createElement('img');
                modalImg.src = this.src;
                modalImg.style.maxWidth = '90%';
                modalImg.style.maxHeight = '90%';
                modalImg.style.borderRadius = '5px';
                modalImg.style.boxShadow = '0 5px 25px rgba(0,0,0,0.5)';
                
                modal.appendChild(modalImg);
                document.body.appendChild(modal);
                
                // ç‚¹å‡»å…³é—­æ¨¡æ€æ¡†
                modal.addEventListener('click', function() {
                    document.body.removeChild(modal);
                });
            });
        });
        
        // 2. ä¸ºä»£ç å—æ·»åŠ å¤åˆ¶æŒ‰é’®
        const codeBlocks = document.querySelectorAll('.article-content pre');
        codeBlocks.forEach(pre => {
            // æ£€æŸ¥æ˜¯å¦å·²ç»æ·»åŠ äº†å¤åˆ¶æŒ‰é’®
            if (!pre.querySelector('.copy-code-btn')) {
                const copyBtn = document.createElement('button');
                copyBtn.className = 'copy-code-btn';
                copyBtn.textContent = 'å¤åˆ¶';
                copyBtn.style.position = 'absolute';
                copyBtn.style.top = '5px';
                copyBtn.style.right = '5px';
                copyBtn.style.background = '#007bff';
                copyBtn.style.color = 'white';
                copyBtn.style.border = 'none';
                copyBtn.style.borderRadius = '3px';
                copyBtn.style.padding = '3px 8px';
                copyBtn.style.fontSize = '0.8rem';
                copyBtn.style.cursor = 'pointer';
                copyBtn.style.zIndex = '10';
                
                pre.style.position = 'relative';
                pre.appendChild(copyBtn);
                
                copyBtn.addEventListener('click', function() {
                    const code = pre.querySelector('code').innerText;
                    navigator.clipboard.writeText(code).then(() => {
                        const originalText = copyBtn.textContent;
                        copyBtn.textContent = 'å·²å¤åˆ¶!';
                        copyBtn.style.background = '#28a745';
                        
                        setTimeout(() => {
                            copyBtn.textContent = originalText;
                            copyBtn.style.background = '#007bff';
                        }, 2000);
                    });
                });
            }
        });
        
        // 3. ä¸ºè¡¨æ ¼æ·»åŠ å“åº”å¼åŒ…è£…
        const tables = document.querySelectorAll('.article-content table');
        tables.forEach(table => {
            const wrapper = document.createElement('div');
            wrapper.style.overflowX = 'auto';
            wrapper.style.marginBottom = '1.2rem';
            
            table.parentNode.insertBefore(wrapper, table);
            wrapper.appendChild(table);
        });
        
        // 4. è‡ªåŠ¨ä¸ºæ ‡é¢˜æ·»åŠ é”šç‚¹é“¾æ¥ï¼ˆå¯é€‰ï¼‰
        const headings = document.querySelectorAll('.article-content h2, .article-content h3, .article-content h4');
        headings.forEach(heading => {
            // ä¸ºæ ‡é¢˜æ·»åŠ idï¼ˆåŸºäºæ–‡æœ¬å†…å®¹ç”Ÿæˆï¼‰
            const id = heading.textContent
                .toLowerCase()
                .replace(/[^\w\u4e00-\u9fa5]+/g, '-')
                .replace(/^-|-$/g, '');
            
            heading.id = id;
            
            // æ·»åŠ é”šç‚¹é“¾æ¥å›¾æ ‡
            const anchor = document.createElement('a');
            anchor.href = `#${id}`;
            anchor.innerHTML = 'ğŸ”—';
            anchor.style.marginLeft = '10px';
            anchor.style.textDecoration = 'none';
            anchor.style.opacity = '0.5';
            anchor.style.fontSize = '0.8em';
            
            anchor.addEventListener('mouseenter', function() {
                this.style.opacity = '1';
            });
            
            anchor.addEventListener('mouseleave', function() {
                this.style.opacity = '0.5';
            });
            
            heading.appendChild(anchor);
        });
    });
</script>
{% endblock %}